(function(t){function e(e){for(var a,r,s=e[0],l=e[1],c=e[2],d=0,u=[];d<s.length;d++)r=s[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&u.push(n[r][0]),n[r]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);h&&h(e);while(u.length)u.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],a=!0,s=1;s<i.length;s++){var l=i[s];0!==n[l]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=i[0]))}return t}var a={},n={app:0},o=[];function r(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=a,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var h=l;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";i("85ec")},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("HelloWorld",{attrs:{msg:"Welcome to Your Vue.js App"}})],1)},o=[],r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main"},[i("img",{style:"left:"+-t.imgWidth+"px;top:"+-t.imgHeight+"px",attrs:{id:"imgDemo",src:t.originImg},on:{load:t.loadImg}}),i("div",{staticClass:"canvas-content"},[i("el-col",{ref:"originBox",staticClass:"origin-box",attrs:{xs:24,sm:24,md:12,lg:{span:8,offset:2},xl:{span:8,offset:2}}},[i("div",{ref:"originCanvasContent",staticClass:"origin-canvas-content",style:"width:"+t.canWidth+"px"},[i("canvas",{ref:"originCan",attrs:{id:"beforeCan",width:t.canWidth,height:t.canHeight}}),i("canvas",{ref:"layerCan",attrs:{id:"layer",width:t.canWidth,height:t.canHeight},on:{click:t.pickPoint}}),i("el-upload",{ref:"logoUpload",staticClass:"avatar-uploader",attrs:{accept:"image/*",action:"#","auto-upload":!1,"on-change":t.handleStatusChange}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1)]),i("el-col",{staticClass:"opereation-box",attrs:{xs:24,sm:24,md:12,lg:4,xl:4}},[i("div",{staticClass:"removeColor"},[i("h3",[t._v("清除颜色：")]),i("el-button",{attrs:{disabled:!t.fromColor},on:{click:function(e){return t.handleTrans("remove")}}},[t._v("清除")])],1),i("div",{staticClass:"replace-color"},[i("h3",[t._v("颜色替换：")]),i("el-color-picker",{attrs:{"show-alpha":!0},model:{value:t.fromColor,callback:function(e){t.fromColor=e},expression:"fromColor"}}),i("el-button",{staticClass:"replace-btn",attrs:{disabled:!t.fromColor},on:{click:function(){return t.handleTrans()}}},[t._v("替换")]),i("el-color-picker",{attrs:{"show-alpha":!0},model:{value:t.toColor,callback:function(e){t.toColor=e},expression:"toColor"}})],1)]),i("el-col",{staticClass:"trans-box",attrs:{xs:24,sm:24,md:12,lg:8,xl:8}},[i("canvas",{ref:"transCan",attrs:{id:"transCan",width:t.canWidth,height:t.canHeight},on:{click:t.pickPoint}}),i("div",{staticClass:"box"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.downloadPng}},[t._v("下载图片")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.resetImgData}},[t._v("重置")]),i("el-button",{attrs:{size:"small",type:"primary",disabled:t.disUndo},on:{click:t.undo}},[t._v("后退")]),i("el-button",{attrs:{size:"small",type:"primary",disabled:!t.index},on:{click:t.redo}},[t._v("前进")])],1)])],1)])},s=[],l=(i("d81d"),i("a15b"),i("ac1f"),i("1276"),i("fb6a"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),{name:"HelloWorld",props:{msg:String},data:function(){return{canWidth:400,canHeight:400,originCtx:null,layerCtx:null,transCtx:null,selectedColor:[],imgWidth:400,imgHeight:400,imageData:{},toColor:"rgba(0, 0, 0, 0)",originImg:"",loadFileName:"",imgStock:[],index:0}},computed:{fromColor:function(){var t=this.selectedColor.map((function(t,e){return 3===e?t/255:t}));return t.length?"rgba("+t.join(",")+")":null},transColor:function(){return this.toColor.split(/\(|\)/)[1].split(",")},disUndo:function(){return this.index>=this.imgStock.length-1}},mounted:function(){var t=this;this.$nextTick((function(){var e=document.querySelector("#app").offsetWidth;t.canWidth=Math.min(e-12,t.canWidth)}))},methods:{loadImg:function(t){var e=this,i=t.target,a=i.offsetWidth,n=i.offsetHeight;this.imgWidth=a,this.imgHeight=n,this.canHeight=n/a*this.canWidth,setTimeout((function(){e.originCtx=e.$refs.originCan.getContext("2d"),e.layerCtx=e.$refs.layerCan.getContext("2d"),e.transCtx=e.$refs.transCan.getContext("2d"),e.originCtx.scale(e.canWidth/a,e.canWidth/a),e.originCtx.drawImage(i,0,0),e.resetImgData()}),0)},addStock:function(t){this.index&&(this.imgStock=this.imgStock.slice(this.index),this.index=0),this.imgStock.length>=10&&this.imgStock.pop(),this.imgStock.unshift(JSON.stringify(t))},undo:function(){this.index++,this.redrawImg()},redo:function(){this.index--,this.redrawImg()},redrawImg:function(){var t=JSON.parse(this.imgStock[this.index]).data;this.imageData=this.transCtx.createImageData(this.canWidth,this.canHeight);for(var e=0;e<this.imageData.data.length;e++)this.imageData.data[e]=t[e];this.transCtx.putImageData(this.imageData,0,0)},handleTrans:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"replace",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectedColor,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.transColor,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n="remove"===t?[0,0,0,0]:i,o=this.imageData.data||[];console.time("no-worker");for(var r=0;r<o.length;r+=4){var s=this.isSimilar(e,o.slice(r,r+4));s&&(o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=255*n[3])}console.timeEnd("no-worker"),a&&this.addStock(this.imageData),this.transCtx.putImageData(this.imageData,0,0),this.imageData=this.transCtx.getImageData(0,0,this.canWidth,this.canHeight)},pickPoint:function(t){this.selectedColor=this.originCtx.getImageData(t.layerX,t.layerY,1,1).data;var e=this.getOpposite(this.selectedColor);this.canWidth=this.canWidth+0,this.layerCtx.strokeStyle=e,this.layerCtx.clearRect(0,0,this.canWidth,this.canHeight),this.layerCtx.strokeRect(t.layerX-3,t.layerY-3,6,6)},getOpposite:function(t){for(var e=[],i=0;i<3;i++)e.push(255-t[i]);return e.push(255),"rgba(".concat(e.join(","),")")},isSimilar:function(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(Math.abs(t[i]-e[i])>20)return!1;return!0},handleStatusChange:function(t){this.originImg=URL.createObjectURL(t.raw)},downloadPng:function(){var t=this.$refs.transCan.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="download.png",e.click()},resetImgData:function(){this.imgStock=[],this.index=0,this.selectedColor=this.$options.data().selectedColor,this.toColor=this.$options.data().toColor,this.imageData=this.originCtx.getImageData(0,0,this.canWidth,this.canHeight),this.transCtx.clearRect(0,0,this.canWidth,this.canHeight),this.addStock(this.imageData)}}}),c=l,h=(i("eb99"),i("2877")),d=Object(h["a"])(c,r,s,!1,null,"5729e48e",null),u=d.exports,g={name:"App",components:{HelloWorld:u}},f=g,p=(i("034f"),Object(h["a"])(f,n,o,!1,null,null,null)),m=p.exports,C=i("5c96"),v=i.n(C);i("0fae");a["default"].config.productionTip=!1,a["default"].use(v.a),new a["default"]({render:function(t){return t(m)}}).$mount("#app")},"85ec":function(t,e,i){},c25c:function(t,e,i){},eb99:function(t,e,i){"use strict";i("c25c")}});
//# sourceMappingURL=app.2a78cb0d.js.map