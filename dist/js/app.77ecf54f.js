(function(t){function e(e){for(var i,r,s=e[0],l=e[1],c=e[2],h=0,u=[];h<s.length;h++)r=s[h],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&u.push(n[r][0]),n[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);d&&d(e);while(u.length)u.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],i=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(i=!1)}i&&(o.splice(e--,1),t=r(r.s=a[0]))}return t}var i={},n={app:0},o=[];function r(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=i,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";a("85ec")},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("HelloWorld",{attrs:{msg:"Welcome to Your Vue.js App"}})],1)},o=[],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("img",{attrs:{id:"imgDemo",src:t.originImg},on:{load:t.loadImg}}),a("div",{staticClass:"canvas-content"},[a("el-col",{ref:"originBox",staticClass:"origin-box",attrs:{xs:24,sm:24,md:12,lg:{span:8,offset:2},xl:{span:8,offset:2}}},[a("div",{ref:"originCanvasContent",staticClass:"origin-canvas-content",style:"width:"+t.canWidth+"px"},[a("canvas",{ref:"originCan",attrs:{id:"beforeCan",width:t.canWidth,height:t.canHeight}}),a("canvas",{ref:"layerCan",attrs:{id:"layer",width:t.canWidth,height:t.canHeight},on:{click:t.pickPoint}}),a("el-upload",{ref:"logoUpload",staticClass:"avatar-uploader",attrs:{accept:"image/*",action:"http://localhost:3000/api/upload/uploadImg","show-file-list":!1,"on-success":t.handleAvatarSuccess,"on-error":t.handleAvatarError,"on-change":t.handleStatusChange,"before-upload":t.beforeAvatarUpload}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1)],1)]),a("el-col",{staticClass:"opereation-box",attrs:{xs:24,sm:24,md:12,lg:4,xl:4}},[a("div",{staticClass:"removeColor"},[a("h3",[t._v("清除颜色：")]),a("el-button",{attrs:{disabled:!t.fromColor},on:{click:function(e){return t.handleTrans("remove")}}},[t._v("清除")])],1),a("div",{staticClass:"replace-color"},[a("h3",[t._v("颜色替换：")]),a("el-color-picker",{attrs:{"show-alpha":!0},model:{value:t.fromColor,callback:function(e){t.fromColor=e},expression:"fromColor"}}),a("el-button",{staticClass:"replace-btn",attrs:{disabled:!t.fromColor},on:{click:function(){return t.handleTrans()}}},[t._v("替换")]),a("el-color-picker",{attrs:{"show-alpha":!0},model:{value:t.toColor,callback:function(e){t.toColor=e},expression:"toColor"}})],1)]),a("el-col",{staticClass:"trans-box",attrs:{xs:24,sm:24,md:12,lg:8,xl:8}},[a("canvas",{ref:"transCan",attrs:{id:"transCan",width:t.canWidth,height:t.canHeight},on:{click:t.pickPoint}}),a("div",{staticClass:"box"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.downloadPng}},[t._v("下载图片")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.resetImgData}},[t._v("重置")]),a("el-button",{attrs:{size:"small",type:"primary",disabled:t.disUndo},on:{click:t.undo}},[t._v("后退")]),a("el-button",{attrs:{size:"small",type:"primary",disabled:!t.index},on:{click:t.redo}},[t._v("前进")])],1)]),a("img",{attrs:{src:t.originImg,width:"400"}})],1)])},s=[],l=(a("d81d"),a("a15b"),a("ac1f"),a("1276"),a("fb6a"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("caad"),{name:"HelloWorld",props:{msg:String},data:function(){return{canWidth:400,canHeight:400,originCtx:null,layerCtx:null,transCtx:null,selectedColor:[],imgWidth:400,imgHeight:400,imageData:{},toColor:"rgba(0, 0, 0, 0)",originImg:"",loadFileName:"",imgStock:[],index:0}},computed:{fromColor:function(){var t=this.selectedColor.map((function(t,e){return 3===e?t/255:t}));return t.length?"rgba("+t.join(",")+")":null},transColor:function(){return this.toColor.split(/\(|\)/)[1].split(",")},disUndo:function(){return this.index>=this.imgStock.length-1}},mounted:function(){var t=this;this.$nextTick((function(){var e=document.querySelector("#app").offsetWidth;t.canWidth=Math.min(e-12,t.canWidth)}))},methods:{loadImg:function(t){var e=this,a=t.target,i=a.offsetWidth,n=a.offsetHeight;this.imgWidth=i,this.imgHeight=n,this.canHeight=n/i*this.canWidth,setTimeout((function(){e.originCtx=e.$refs.originCan.getContext("2d"),e.layerCtx=e.$refs.layerCan.getContext("2d"),e.transCtx=e.$refs.transCan.getContext("2d"),e.originCtx.scale(e.canWidth/i,e.canWidth/i),e.originCtx.drawImage(a,0,0),e.resetImgData()}),0)},addStock:function(t){this.index&&(this.imgStock=this.imgStock.slice(this.index),this.index=0),this.imgStock.length>=10&&this.imgStock.pop(),this.imgStock.unshift(JSON.stringify(t))},undo:function(){this.index++,this.redrawImg()},redo:function(){this.index--,this.redrawImg()},redrawImg:function(){var t=JSON.parse(this.imgStock[this.index]).data;this.imageData=this.transCtx.createImageData(this.canWidth,this.canHeight);for(var e=0;e<this.imageData.data.length;e++)this.imageData.data[e]=t[e];this.transCtx.putImageData(this.imageData,0,0)},handleTrans:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"replace",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectedColor,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.transColor,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n="remove"===t?[0,0,0,0]:a,o=this.imageData.data||[];console.time("no-worker");for(var r=0;r<o.length;r+=4){var s=this.isSimilar(e,o.slice(r,r+4));s&&(o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=255*n[3])}console.timeEnd("no-worker"),i&&this.addStock(this.imageData),this.transCtx.putImageData(this.imageData,0,0),this.imageData=this.transCtx.getImageData(0,0,this.canWidth,this.canHeight)},pickPoint:function(t){this.selectedColor=this.originCtx.getImageData(t.layerX,t.layerY,1,1).data;var e=this.getOpposite(this.selectedColor);this.canWidth=this.canWidth+0,this.layerCtx.strokeStyle=e,this.layerCtx.clearRect(0,0,this.canWidth,this.canHeight),this.layerCtx.strokeRect(t.layerX-3,t.layerY-3,6,6)},getOpposite:function(t){for(var e=[],a=0;a<3;a++)e.push(255-t[a]);return e.push(255),"rgba(".concat(e.join(","),")")},isSimilar:function(t,e){if(t.length!==e.length)return!1;for(var a=0;a<t.length;a++)if(Math.abs(t[a]-e[a])>20)return!1;return!0},handleAvatarSuccess:function(t,e){this.loadFileName=e.response.filename,this.originImg=URL.createObjectURL(e.raw)},handleAvatarError:function(t,e){alert(t),console.log(e)},handleStatusChange:function(t,e){console.log(t,e)},beforeAvatarUpload:function(t){var e=["image/jpeg","image/jpg","image/png","image/gif"].includes(t.type),a=t.size/1024/1024<2;return e||this.$message.error("上传头像必须是图片格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&a},downloadPng:function(){var t=this.$refs.transCan.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download="download.png",e.click()},resetImgData:function(){this.imgStock=[],this.index=0,this.selectedColor=this.$options.data().selectedColor,this.toColor=this.$options.data().toColor,this.imageData=this.originCtx.getImageData(0,0,this.canWidth,this.canHeight),this.transCtx.clearRect(0,0,this.canWidth,this.canHeight),this.addStock(this.imageData)}}}),c=l,d=(a("93e3"),a("2877")),h=Object(d["a"])(c,r,s,!1,null,"1d051c01",null),u=h.exports,g={name:"App",components:{HelloWorld:u}},f=g,m=(a("034f"),Object(d["a"])(f,n,o,!1,null,null,null)),p=m.exports,v=a("5c96"),C=a.n(v);a("0fae");i["default"].config.productionTip=!1,i["default"].use(C.a),new i["default"]({render:function(t){return t(p)}}).$mount("#app")},"85ec":function(t,e,a){},"93e3":function(t,e,a){"use strict";a("da37")},da37:function(t,e,a){}});
//# sourceMappingURL=app.77ecf54f.js.map